{"version":3,"sources":["Common.js","views/Comments.jsx","views/Gallery.jsx","App.js","Routing.js","index.js"],"names":["Utils","API","get","response","state","trim","Error","console","error","Comments","props","getComments","bind","createComment","comments","newComment","isSecondaryRegion","commentInput","React","createRef","this","setState","photoId","imageKey","log","current","value","getAppState","primaryAppStateUrl","secondaryAppStateUrl","appState","toUpperCase","alert","commentId","uuid","message","user","params","body","post","updatedComments","push","className","map","comment","Form","Row","Col","Control","type","placeholder","id","ref","onChange","handleCommentChanged","sm","Button","variant","onClick","beginCreateCommentWorkflow","Component","Gallery","loadImages","imageSelected","images","selectedImage","showImageDetailsModal","level","Storage","list","item","a","key","presignedUrl","image","imgTags","Image","thumbnail","src","Modal","size","show","onHide","Body","Container","fluid","library","add","faUpload","App","signOut","beginUploadImageWorkflow","showImageGallery","showUploadImageModal","uploadInProgress","username","region","appConfig","Auth","currentAuthenticatedUser","uiState","amplifyConfig","AWSS3","identityPoolId","endpoints","name","endpoint","primary","secondary","bucket","objectStoreBucketName","photosApi","Amplify","configure","catch","err","put","file","finally","window","location","reload","Navbar","bg","Brand","href","icon","faAws","color","Collapse","Text","faSignOutAlt","Header","closeButton","Title","onPick","data","uploadImage","ProgressBar","animated","now","target","rel","faExternalLinkAlt","withAuthenticator","Routing","ready","endpointUrl","propertyKey","fetch","resp","json","respJson","getConfigResponse","mandatorySignIn","uiRegion","userPoolId","userPoolWebClientId","userPoolClientId","Analytics","disabled","stateUrl","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.220a8d80.chunk.js","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\n/**\n * @author Solution Builders\n */\n\nimport { API } from 'aws-amplify';\n\nexport class Utils {\n    /**\n     * Returns the state (active/fenced/failover) of the application. Calls the primaryAppStateUrl first and uses secondaryAppStateUrl as a fallback\n     */\n    static async getAppState() {\n        try {\n            try {\n                const response = await API.get('PrimaryAppState', '', {});\n                if (!response || !response.state || response.state.trim() === ''){\n                    throw new Error('Unable to retrieve a valid app state');\n                }\n                return response.state;\n            } catch (err) {\n                console.error(`Caught error while querying for the state in the primary region: ${err}`);\n                const response = await API.get('SecondaryAppState', '', {});\n                if (!response || !response.state || response.state.trim() === ''){\n                    throw new Error('Unable to retrieve a valid app state');\n                }\n                return response.state;\n            }\n        } catch (err) {\n            console.error(`Caught error while querying for the state in the secondary region: ${err}`);\n            return null;\n        }\n    }\n}\n\nexport default Utils;","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\n/**\n * @author Solution Builders\n */\n\nimport React from 'react';\nimport { API } from 'aws-amplify';\nimport { Form, Button, Col } from 'react-bootstrap'\n\nimport * as uuid from 'uuid'\n\nimport Utils from '../Common';\n\nexport default class Comments extends React.Component {\n\n  constructor(props) {\n    super(props)\n\n    this.getComments = this.getComments.bind(this)\n    this.createComment = this.createComment.bind(this)\n\n    this.state = {\n      comments: [],\n      newComment: '',\n      isSecondaryRegion: props.isSecondaryRegion\n    }\n\n    this.commentInput = React.createRef()\n  }\n\n  async componentDidMount() {\n    let comments = await this.getComments()\n    this.setState({\n      comments\n    })\n  }\n\n  componentWillUnmount() {\n    this.setState({\n      comments: []\n    })\n  }\n\n  async getComments() {\n\n    try {\n      let photoId = this.props.imageKey\n\n      const response = await API.get('PhotosApi', `/comments/${photoId}`, {});\n      return response.comments\n    } catch (err) {\n      console.log(err)\n      return []\n    }\n  }\n\n  handleCommentChanged() {\n    this.setState({\n      newComment: this.commentInput.current.value\n    })\n  }\n\n  async beginCreateCommentWorkflow() {\n    let appState = await Utils.getAppState(this.props.primaryAppStateUrl, this.props.secondaryAppStateUrl);\n    appState = appState.toUpperCase();\n\n    switch (appState) {\n      case 'FENCED':\n        // Write operations are not permitted when the application is in fenced mode\n        alert('Comments cannot currently be added. Please try again in a few minutes')\n        return;\n      case 'ACTIVE':\n        if (this.state.isSecondaryRegion) {\n          // When the application is in ACTIVE mode, only allow write operations when the \n          // front-end is targeting the primary region\n          alert('Please refresh the application to enable comments');\n          return;\n        }\n        break;\n      case 'FAILOVER':\n        if (!this.state.isSecondaryRegion) {\n          // When the application is in FAILOVER mode, only allow write operations when the \n          // front-end is targeting the secondary region\n          alert('Please refresh the application to enable comments');\n          return;\n        }\n        break;\n      default:\n        throw new Error(`Unsupported app state: ${appState}`);\n    }\n\n    await this.createComment();\n  }\n\n  async createComment() {\n    try {\n      let commentId = uuid.v4()\n      let photoId = this.props.imageKey\n      let message = this.commentInput.current.value\n      let user = this.props.user\n\n      let params = {\n        body: {\n          commentId,\n          photoId,\n          user,\n          message\n        }\n      }\n\n      await API.post('PhotosApi', `/comments/${photoId}`, params);\n\n      let updatedComments = this.state.comments\n      updatedComments.push({\n        user,\n        commentId,\n        message\n      })\n\n      this.setState({\n        comments: updatedComments,\n        newComment: ''\n      })\n\n      this.commentInput.current.value = ''\n    } catch (err) {\n      console.log(err)\n    }\n  }\n\n  render() {\n\n    return (\n      <div>\n\n        <div className='commentsCol'>\n          <ul className='list-group'>\n            {\n              this.state.comments.map(comment => {\n                return <li key={comment.commentId} className='list-group-item'>{comment.user} says: {comment.message}</li>\n              })\n            }\n          </ul>\n        </div>\n\n        <Form className='commentsForm'>\n          <Form.Row>\n            <Col>\n              <Form.Control type=\"text\" placeholder=\"Add Comment\" id=\"add-comment-input\" ref={this.commentInput} onChange={() => this.handleCommentChanged()} />\n            </Col>\n            <Col sm={2}>\n              <Button variant=\"primary\" id=\"create-comment-btn\" onClick={() => this.beginCreateCommentWorkflow()}>\n                Create\n              </Button>\n            </Col>\n          </Form.Row>\n        </Form>\n\n      </div>\n    )\n  }\n}","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\n/**\n * @author Solution Builders\n */\n\nimport React from 'react';\nimport { Storage } from 'aws-amplify'\nimport { Container, Row, Col, Image, Modal } from 'react-bootstrap'\n\nimport Comments from './Comments'\n\nexport default class Gallery extends React.Component {\n\n  constructor(props) {\n    super(props)\n\n    this.loadImages = this.loadImages.bind(this);\n    this.imageSelected = this.imageSelected.bind(this)\n    this.state = {\n      images: [],\n      selectedImage: {},\n      showImageDetailsModal: false,\n      isSecondaryRegion: props.isSecondaryRegion\n    }\n  }\n\n  async componentDidMount() {\n    await this.loadImages();\n  }\n\n  componentWillUnmount() {\n    this.setState({\n      images: []\n    })\n  }\n\n  async loadImages() {\n    const path = '';\n    const level = { level: 'public' };\n    this.setState({ images: [] });\n    let s3Images = await Storage.list(path, level);\n\n    s3Images.map(async item => {\n      let presignedUrl = await Storage.get(item.key, level)\n      this.setState({\n        images: [\n          ...this.state.images,\n          {\n            key: item.key,\n            presignedUrl\n          }\n        ]\n      });\n    });\n  }\n\n  async imageSelected(image) {\n    this.setState({\n      showImageDetailsModal: true,\n      selectedImage: image\n    })\n  }\n\n  render() {\n    let { images } = this.state\n    let imgTags = images.map(image => {\n      return (\n        <Image\n          thumbnail\n          key={image.key}\n          src={image.presignedUrl}\n          onClick={() => this.imageSelected(image)}\n          className='thumbnail' />\n\n      )\n    })\n\n    return (\n      <div>\n\n        {imgTags}\n\n        <Modal size='lg' className='detailsModal' show={this.state.showImageDetailsModal} onHide={() => this.setState({ showImageDetailsModal: false })}>\n          <Modal.Body>\n            <Container>\n              <Row>\n                <Col>\n                  <Image fluid src={this.state.selectedImage.presignedUrl} />\n                </Col>\n                <Col>\n                  <Comments imageKey={this.state.selectedImage.key} user={this.props.user} primaryAppStateUrl={this.props.primaryAppStateUrl} secondaryAppStateUrl={this.props.secondaryAppStateUrl} isSecondaryRegion={this.state.isSecondaryRegion} />\n                </Col>\n              </Row>\n            </Container>\n          </Modal.Body>\n        </Modal>\n      </div>\n    )\n  }\n}","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\n/**\n * @author Solution Builders\n */\n\nimport React from 'react';\nimport Amplify from 'aws-amplify';\nimport { Auth, Storage } from 'aws-amplify'\nimport { PhotoPicker, withAuthenticator } from 'aws-amplify-react'\nimport { Button, Modal, ProgressBar, Navbar } from 'react-bootstrap'\n\nimport * as uuid from 'uuid'\n\nimport Gallery from './views/Gallery'\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { library } from '@fortawesome/fontawesome-svg-core'\nimport { faUpload, faSignOutAlt, faExternalLinkAlt } from '@fortawesome/free-solid-svg-icons'\nimport { faAws } from '@fortawesome/free-brands-svg-icons';\n\nimport Utils from './Common';\n\nlibrary.add(\n  faUpload\n)\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props)\n    this.signOut = this.signOut.bind(this)\n    this.beginUploadImageWorkflow = this.beginUploadImageWorkflow.bind(this)\n\n    this.state = {\n      showImageGallery: false,\n      showUploadImageModal: false,\n      uploadInProgress: false,\n      username: '',\n      region: '',\n      primaryAppStateUrl: props.primaryAppStateUrl,\n      secondaryAppStateUrl: props.secondaryAppStateUrl,\n      appConfig: props.appConfig\n    }\n  }\n\n  async componentDidMount() {\n    let user = await Auth.currentAuthenticatedUser();\n    let appState = await Utils.getAppState(this.state.primaryAppStateUrl, this.state.secondaryAppStateUrl);\n    appState = appState.toUpperCase();\n\n    const uiState = { username: user.username, showImageGallery: true };\n    const amplifyConfig = {\n      Storage: {\n        AWSS3: {\n          identityPoolId: this.state.appConfig.identityPoolId,\n        },\n        level: 'public'\n      },\n      API: {\n        endpoints: [\n          {\n            name: 'PrimaryAppState',\n            endpoint: this.state.primaryAppStateUrl,\n            region: this.state.appConfig.primary.region\n          },\n          {\n            name: 'SecondaryAppState',\n            endpoint: this.state.secondaryAppStateUrl,\n            region: this.state.appConfig.secondary.region\n          }\n        ]\n      }\n    };\n\n    switch (appState) {\n      case 'FENCED':\n      case 'ACTIVE':\n        uiState.isSecondaryRegion = false;\n        uiState.region = this.state.appConfig.primary.region;\n        amplifyConfig.Storage.AWSS3.bucket = this.state.appConfig.primary.objectStoreBucketName;\n        amplifyConfig.Storage.AWSS3.region = this.state.appConfig.primary.region;\n        amplifyConfig.API.endpoints.push({ name: 'PhotosApi', endpoint: this.state.appConfig.primary.photosApi, region: this.state.appConfig.primary.region });\n        break;\n      case 'FAILOVER':\n        uiState.isSecondaryRegion = true;\n        uiState.region = this.state.appConfig.secondary.region;\n        amplifyConfig.Storage.AWSS3.bucket = this.state.appConfig.secondary.objectStoreBucketName;\n        amplifyConfig.Storage.AWSS3.region = this.state.appConfig.secondary.region;\n        amplifyConfig.API.endpoints.push({ name: 'PhotosApi', endpoint: this.state.appConfig.secondary.photosApi, region: this.state.appConfig.secondary.region });\n        break;\n      default:\n        throw new Error(`Unsupported app state: ${appState}`);\n    }\n\n    Amplify.configure(amplifyConfig);\n    this.setState(uiState);\n  }\n\n  signOut() {\n    Auth.signOut()\n      .catch(err => console.log(err))\n  }\n\n  async beginUploadImageWorkflow() {\n    let appState = await Utils.getAppState(this.state.primaryAppStateUrl, this.state.secondaryAppStateUrl);\n    appState = appState.toUpperCase();\n\n    switch (appState) {\n      case 'FENCED':\n        // Write operations are not permitted when the application is in fenced mode\n        alert('New photos can not currently be uploaded. Please try again in a few minutes')\n        return;\n      case 'ACTIVE':\n        if (this.state.isSecondaryRegion) {\n          // When the application is in ACTIVE mode, only allow write operations when the \n          // front-end is targeting the primary region\n          alert('Please refresh the application to enable photo uploads');\n          return;\n        }\n        break;\n      case 'FAILOVER':\n        if (!this.state.isSecondaryRegion) {\n          // When the application is in FAILOVER mode, only allow write operations when the \n          // front-end is targeting the secondary region\n          alert('Please refresh the application to enable photo uploads');\n          return;\n        }\n        break;\n      default:\n        throw new Error(`Unsupported app state: ${appState}`);\n    }\n\n    this.setState({ showUploadImageModal: true })\n  }\n\n  async uploadImage(image) {\n\n    // An id for the image will be the image's S3 key and DynamoDB hash key\n    let id = uuid.v4()\n\n    this.setState({\n      uploadInProgress: true\n    })\n\n    Storage.put(id, image.file)\n      .finally(() => {\n        this.setState({\n          uploadInProgress: false,\n          showUploadImageModal: false\n        })\n        window.location.reload();\n      })\n  }\n\n  render() {\n    return (\n      <div>\n        <Navbar bg=\"dark\" variant=\"dark\">\n          <Navbar.Brand href=\"/\"> <FontAwesomeIcon icon={faAws} size=\"lg\" color=\"#FF9900\" id=\"logo\" />Current Region: {this.state.region}</Navbar.Brand>\n          <Button variant=\"link\" id=\"upload-image-btn\" className='nav-link' onClick={() => this.beginUploadImageWorkflow()}>\n            <FontAwesomeIcon icon={faUpload} /> Upload Image\n          </Button>\n          <Navbar.Collapse className=\"justify-content-end\">\n            <Navbar.Text>\n              welcome {this.state.username}\n            </Navbar.Text>\n            <Button variant=\"link\" className='nav-link' onClick={() => this.signOut()}><FontAwesomeIcon id=\"icon\" icon={faSignOutAlt} />Sign Out</Button>\n          </Navbar.Collapse>\n        </Navbar>\n\n        <div className=\"main\">\n          {this.state.showImageGallery && <Gallery user={this.state.username} primaryAppStateUrl={this.state.primaryAppStateUrl} secondaryAppStateUrl={this.state.secondaryAppStateUrl} isSecondaryRegion={this.state.isSecondaryRegion} />}\n        </div>\n\n\n        <Modal show={this.state.showUploadImageModal} onHide={() => this.setState({ showUploadImageModal: false })}>\n          <Modal.Header closeButton>\n            <Modal.Title>Upload Image</Modal.Title>\n          </Modal.Header>\n          <Modal.Body>\n            {this.state.uploadInProgress ? null : <PhotoPicker onPick={data => this.uploadImage(data)} />}\n            {\n              this.state.uploadInProgress ?\n                <div>\n                  <h1>Uploading...</h1>\n                  <ProgressBar animated now={60} />\n                </div> : null\n            }\n          </Modal.Body>\n        </Modal>\n\n        <div className=\"footer\">\n          <p>Find out more at <a className=\"text-link\" href=\"https://aws.amazon.com/solutions/\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\">\n            aws solutions <FontAwesomeIcon size=\"sm\" icon={faExternalLinkAlt} />\n          </a></p>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default withAuthenticator(App);\n","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\n/**\n * @author Solution Builders\n */\n\nimport React from 'react';\nimport Amplify from 'aws-amplify'\n\nimport App from './App'\n\nclass Routing extends React.Component {\n\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            ready: false,\n            region: ''\n        }\n    }\n\n    async getPropertyFromEndpoint(endpointUrl, propertyKey) {\n        const resp = await fetch(endpointUrl);\n        const respJson = await resp.json();\n        return respJson[propertyKey];\n    }\n\n    async componentDidMount() {\n        try {\n            const getConfigResponse = await fetch('./uiConfig.json');\n            const appConfig = await getConfigResponse.json();\n\n            const amplifyConfig = {\n                Auth: {\n                    mandatorySignIn: true,\n                    region: appConfig.uiRegion,\n                    userPoolId: appConfig.userPoolId,\n                    identityPoolId: appConfig.identityPoolId,\n                    userPoolWebClientId: appConfig.userPoolClientId\n                },\n                Analytics: {\n                    disabled: true\n                },\n                API: {\n                    endpoints: [\n                        {\n                            name: 'PrimaryAppState',\n                            endpoint: appConfig.primary.stateUrl,\n                            region: appConfig.primary.region\n                        },\n                        {\n                            name: 'SecondaryAppState',\n                            endpoint: appConfig.secondary.stateUrl,\n                            region: appConfig.secondary.region\n                        }\n                    ]\n                }\n            };\n\n            Amplify.configure(amplifyConfig);\n\n            this.setState({\n                ready: true,\n                region: appConfig.region,\n                primaryAppStateUrl: appConfig.primary.stateUrl,\n                secondaryAppStateUrl: appConfig.secondary.stateUrl,\n                appConfig\n            });\n        } catch (err) {\n            console.error(err);\n        }\n    }\n\n    render() {\n        if (!this.state.ready) {\n            return <div />\n        }\n\n        return (\n            <App appConfig={this.state.appConfig} primaryAppStateUrl={this.state.primaryAppStateUrl} secondaryAppStateUrl={this.state.secondaryAppStateUrl} />\n        )\n    }\n}\n\nexport default Routing\n","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\n/**\n * @author Solution Builders\n */\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport Routing from './Routing';\n\nimport './assets/css/style.css';\n\nReactDOM.render(<Routing />, document.getElementById('root'));\n"],"sourceRoot":""}