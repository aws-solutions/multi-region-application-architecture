(this["webpackJsonpmulti-reigon-demo-web-console"]=this["webpackJsonpmulti-reigon-demo-web-console"]||[]).push([[0],{567:function(e,t,a){},568:function(e,t,a){"use strict";a.r(t);var n=a(10),r=a(0),s=a.n(r),o=a(48),i=a.n(o),c=(a(158),a(15)),p=a.n(c),u=a(17),l=a(37),d=a(38),m=a(47),h=a(45),g=a(20),b=a(36),f=a(90),j=a(576),y=a(578),v=a(574),O=a(579),x=a(577),S=a(150),k=a(571),w=a(572),C=a(573),I=a(147),A=a(575),U=function(){function e(){Object(l.a)(this,e)}return Object(d.a)(e,null,[{key:"getAppState",value:function(){var e=Object(u.a)(p.a.mark((function e(){var t,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.prev=1,e.next=4,g.a.get("PrimaryAppState","",{});case 4:if((t=e.sent)&&t.state&&""!==t.state.trim()){e.next=7;break}throw new Error("Unable to retrieve a valid app state");case 7:return e.abrupt("return",t.state);case 10:return e.prev=10,e.t0=e.catch(1),console.error("Caught error while querying for the state in the primary region: ".concat(e.t0)),e.next=15,g.a.get("SecondaryAppState","",{});case 15:if((a=e.sent)&&a.state&&""!==a.state.trim()){e.next=18;break}throw new Error("Unable to retrieve a valid app state");case 18:return e.abrupt("return",a.state);case 19:e.next=25;break;case 21:return e.prev=21,e.t1=e.catch(0),console.error("Caught error while querying for the state in the secondary region: ".concat(e.t1)),e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,null,[[0,21],[1,10]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),P=function(e){Object(m.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).getComments=n.getComments.bind(Object(b.a)(n)),n.createComment=n.createComment.bind(Object(b.a)(n)),n.state={comments:[],newComment:"",isSecondaryRegion:e.isSecondaryRegion},n.commentInput=s.a.createRef(),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=Object(u.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getComments();case 2:t=e.sent,this.setState({comments:t});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.setState({comments:[]})}},{key:"getComments",value:function(){var e=Object(u.a)(p.a.mark((function e(){var t,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.props.imageKey,e.next=4,g.a.get("PhotosApi","/comments/".concat(t),{});case 4:return a=e.sent,e.abrupt("return",a.comments);case 8:return e.prev=8,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"handleCommentChanged",value:function(){this.setState({newComment:this.commentInput.current.value})}},{key:"beginCreateCommentWorkflow",value:function(){var e=Object(u.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.getAppState(this.props.primaryAppStateUrl,this.props.secondaryAppStateUrl);case 2:t=(t=e.sent).toUpperCase(),e.t0=t,e.next="FENCED"===e.t0?7:"ACTIVE"===e.t0?9:"FAILOVER"===e.t0?13:17;break;case 7:return alert("Comments cannot currently be added. Please try again in a few minutes"),e.abrupt("return");case 9:if(!this.state.isSecondaryRegion){e.next=12;break}return alert("Please refresh the application to enable comments"),e.abrupt("return");case 12:return e.abrupt("break",18);case 13:if(this.state.isSecondaryRegion){e.next=16;break}return alert("Please refresh the application to enable comments"),e.abrupt("return");case 16:return e.abrupt("break",18);case 17:throw new Error("Unsupported app state: ".concat(t));case 18:return e.next=20,this.createComment();case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createComment",value:function(){var e=Object(u.a)(p.a.mark((function e(){var t,a,n,r,s,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=x.a(),a=this.props.imageKey,n=this.commentInput.current.value,r=this.props.user,s={body:{commentId:t,photoId:a,user:r,message:n}},e.next=8,g.a.post("PhotosApi","/comments/".concat(a),s);case 8:(o=this.state.comments).push({user:r,commentId:t,message:n}),this.setState({comments:o,newComment:""}),this.commentInput.current.value="",e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.log(e.t0);case 17:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{children:[Object(n.jsx)("div",{className:"commentsCol",children:Object(n.jsx)("ul",{className:"list-group",children:this.state.comments.map((function(e){return Object(n.jsxs)("li",{className:"list-group-item",children:[e.user," says: ",e.message]},e.commentId)}))})}),Object(n.jsx)(A.a,{className:"commentsForm",children:Object(n.jsxs)(A.a.Row,{children:[Object(n.jsx)(I.a,{children:Object(n.jsx)(A.a.Control,{type:"text",placeholder:"Add Comment",id:"add-comment-input",ref:this.commentInput,onChange:function(){return e.handleCommentChanged()}})}),Object(n.jsx)(I.a,{sm:2,children:Object(n.jsx)(y.a,{variant:"primary",id:"create-comment-btn",onClick:function(){return e.beginCreateCommentWorkflow()},children:"Create"})})]})})]})}}]),a}(s.a.Component),R=function(e){Object(m.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).loadImages=n.loadImages.bind(Object(b.a)(n)),n.imageSelected=n.imageSelected.bind(Object(b.a)(n)),n.state={images:[],selectedImage:{},showImageDetailsModal:!1,isSecondaryRegion:e.isSecondaryRegion},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=Object(u.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadImages();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.setState({images:[]})}},{key:"loadImages",value:function(){var e=Object(u.a)(p.a.mark((function e(){var t,a=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"",t={level:"public"},this.setState({images:[]}),e.next=5,g.c.list("",t);case 5:e.sent.map(function(){var e=Object(u.a)(p.a.mark((function e(n){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.c.get(n.key,t);case 2:r=e.sent,a.setState({images:[].concat(Object(S.a)(a.state.images),[{key:n.key,presignedUrl:r}])});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"imageSelected",value:function(){var e=Object(u.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({showImageDetailsModal:!0,selectedImage:t});case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.images.map((function(t){return Object(n.jsx)(k.a,{thumbnail:!0,src:t.presignedUrl,onClick:function(){return e.imageSelected(t)},className:"thumbnail"},t.key)}));return Object(n.jsxs)("div",{children:[t,Object(n.jsx)(v.a,{size:"lg",className:"detailsModal",show:this.state.showImageDetailsModal,onHide:function(){return e.setState({showImageDetailsModal:!1})},children:Object(n.jsx)(v.a.Body,{children:Object(n.jsx)(w.a,{children:Object(n.jsxs)(C.a,{children:[Object(n.jsx)(I.a,{children:Object(n.jsx)(k.a,{fluid:!0,src:this.state.selectedImage.presignedUrl})}),Object(n.jsx)(I.a,{children:Object(n.jsx)(P,{imageKey:this.state.selectedImage.key,user:this.props.user,primaryAppStateUrl:this.props.primaryAppStateUrl,secondaryAppStateUrl:this.props.secondaryAppStateUrl,isSecondaryRegion:this.state.isSecondaryRegion})})]})})})})]})}}]),a}(s.a.Component),E=a(60),N=a(50),M=a(61),W=a(149);N.b.add(M.c);var D=function(e){Object(m.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).signOut=n.signOut.bind(Object(b.a)(n)),n.beginUploadImageWorkflow=n.beginUploadImageWorkflow.bind(Object(b.a)(n)),n.state={showImageGallery:!1,showUploadImageModal:!1,uploadInProgress:!1,username:"",region:"",primaryAppStateUrl:e.primaryAppStateUrl,secondaryAppStateUrl:e.secondaryAppStateUrl,appConfig:e.appConfig},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=Object(u.a)(p.a.mark((function e(){var t,a,n,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.b.currentAuthenticatedUser();case 2:return t=e.sent,e.next=5,U.getAppState(this.state.primaryAppStateUrl,this.state.secondaryAppStateUrl);case 5:a=(a=e.sent).toUpperCase(),n={username:t.username,showImageGallery:!0},r={Storage:{AWSS3:{identityPoolId:this.state.appConfig.identityPoolId},level:"public"},API:{endpoints:[{name:"PrimaryAppState",endpoint:this.state.primaryAppStateUrl,region:this.state.appConfig.primary.region},{name:"SecondaryAppState",endpoint:this.state.secondaryAppStateUrl,region:this.state.appConfig.secondary.region}]}},e.t0=a,e.next="FENCED"===e.t0||"ACTIVE"===e.t0?12:"FAILOVER"===e.t0?18:24;break;case 12:return n.isSecondaryRegion=!1,n.region=this.state.appConfig.primary.region,r.Storage.AWSS3.bucket=this.state.appConfig.primary.objectStoreBucketName,r.Storage.AWSS3.region=this.state.appConfig.primary.region,r.API.endpoints.push({name:"PhotosApi",endpoint:this.state.appConfig.primary.photosApi,region:this.state.appConfig.primary.region}),e.abrupt("break",25);case 18:return n.isSecondaryRegion=!0,n.region=this.state.appConfig.secondary.region,r.Storage.AWSS3.bucket=this.state.appConfig.secondary.objectStoreBucketName,r.Storage.AWSS3.region=this.state.appConfig.secondary.region,r.API.endpoints.push({name:"PhotosApi",endpoint:this.state.appConfig.secondary.photosApi,region:this.state.appConfig.secondary.region}),e.abrupt("break",25);case 24:throw new Error("Unsupported app state: ".concat(a));case 25:g.d.configure(r),this.setState(n);case 27:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signOut",value:function(){g.b.signOut().catch((function(e){return console.log(e)}))}},{key:"beginUploadImageWorkflow",value:function(){var e=Object(u.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.getAppState(this.state.primaryAppStateUrl,this.state.secondaryAppStateUrl);case 2:t=(t=e.sent).toUpperCase(),e.t0=t,e.next="FENCED"===e.t0?7:"ACTIVE"===e.t0?9:"FAILOVER"===e.t0?13:17;break;case 7:return alert("New photos can not currently be uploaded. Please try again in a few minutes"),e.abrupt("return");case 9:if(!this.state.isSecondaryRegion){e.next=12;break}return alert("Please refresh the application to enable photo uploads"),e.abrupt("return");case 12:return e.abrupt("break",18);case 13:if(this.state.isSecondaryRegion){e.next=16;break}return alert("Please refresh the application to enable photo uploads"),e.abrupt("return");case 16:return e.abrupt("break",18);case 17:throw new Error("Unsupported app state: ".concat(t));case 18:this.setState({showUploadImageModal:!0});case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"uploadImage",value:function(){var e=Object(u.a)(p.a.mark((function e(t){var a,n=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=x.a(),this.setState({uploadInProgress:!0}),g.c.put(a,t.file).finally((function(){n.setState({uploadInProgress:!1,showUploadImageModal:!1}),window.location.reload()}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{children:[Object(n.jsxs)(j.a,{bg:"dark",variant:"dark",children:[Object(n.jsxs)(j.a.Brand,{href:"/",children:[" ",Object(n.jsx)(E.a,{icon:W.a,size:"lg",color:"#FF9900",id:"logo"}),"Current Region: ",this.state.region]}),Object(n.jsxs)(y.a,{variant:"link",id:"upload-image-btn",className:"nav-link",onClick:function(){return e.beginUploadImageWorkflow()},children:[Object(n.jsx)(E.a,{icon:M.c})," Upload Image"]}),Object(n.jsxs)(j.a.Collapse,{className:"justify-content-end",children:[Object(n.jsxs)(j.a.Text,{children:["welcome ",this.state.username]}),Object(n.jsxs)(y.a,{variant:"link",className:"nav-link",onClick:function(){return e.signOut()},children:[Object(n.jsx)(E.a,{id:"icon",icon:M.b}),"Sign Out"]})]})]}),Object(n.jsx)("div",{className:"main",children:this.state.showImageGallery&&Object(n.jsx)(R,{user:this.state.username,primaryAppStateUrl:this.state.primaryAppStateUrl,secondaryAppStateUrl:this.state.secondaryAppStateUrl,isSecondaryRegion:this.state.isSecondaryRegion})}),Object(n.jsxs)(v.a,{show:this.state.showUploadImageModal,onHide:function(){return e.setState({showUploadImageModal:!1})},children:[Object(n.jsx)(v.a.Header,{closeButton:!0,children:Object(n.jsx)(v.a.Title,{children:"Upload Image"})}),Object(n.jsxs)(v.a.Body,{children:[this.state.uploadInProgress?null:Object(n.jsx)(f.a,{onPick:function(t){return e.uploadImage(t)}}),this.state.uploadInProgress?Object(n.jsxs)("div",{children:[Object(n.jsx)("h1",{children:"Uploading..."}),Object(n.jsx)(O.a,{animated:!0,now:60})]}):null]})]}),Object(n.jsx)("div",{className:"footer",children:Object(n.jsxs)("p",{children:["Find out more at ",Object(n.jsxs)("a",{className:"text-link",href:"https://aws.amazon.com/solutions/",target:"_blank",rel:"noopener noreferrer",children:["aws solutions ",Object(n.jsx)(E.a,{size:"sm",icon:M.a})]})]})})]})}}]),a}(s.a.Component),F=Object(f.b)(D),B=function(e){Object(m.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={ready:!1,region:""},n}return Object(d.a)(a,[{key:"getPropertyFromEndpoint",value:function(){var e=Object(u.a)(p.a.mark((function e(t,a){var n,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,e.abrupt("return",r[a]);case 7:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(u.a)(p.a.mark((function e(){var t,a,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("./uiConfig.json");case 3:return t=e.sent,e.next=6,t.json();case 6:a=e.sent,n={Auth:{mandatorySignIn:!0,region:a.uiRegion,userPoolId:a.userPoolId,identityPoolId:a.identityPoolId,userPoolWebClientId:a.userPoolClientId},Analytics:{disabled:!0},API:{endpoints:[{name:"PrimaryAppState",endpoint:a.primary.stateUrl,region:a.primary.region},{name:"SecondaryAppState",endpoint:a.secondary.stateUrl,region:a.secondary.region}]}},g.d.configure(n),this.setState({ready:!0,region:a.region,primaryAppStateUrl:a.primary.stateUrl,secondaryAppStateUrl:a.secondary.stateUrl,appConfig:a}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.ready?Object(n.jsx)(F,{appConfig:this.state.appConfig,primaryAppStateUrl:this.state.primaryAppStateUrl,secondaryAppStateUrl:this.state.secondaryAppStateUrl}):Object(n.jsx)("div",{})}}]),a}(s.a.Component);a(567);i.a.render(Object(n.jsx)(B,{}),document.getElementById("root"))},77:function(e,t){}},[[568,1,2]]]);
//# sourceMappingURL=main.220a8d80.chunk.js.map